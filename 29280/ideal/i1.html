<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Type & Conquer</title>
    <style>
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f8f9fa;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }

      .game-container {
        background-color: #ffffff;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        width: 90%;
        max-width: 700px;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 36px;
        letter-spacing: 1px;
      }

      label {
        font-size: 18px;
        font-weight: bold;
        color: #34495e;
      }

      select {
        padding: 10px;
        margin-left: 10px;
        font-size: 16px;
        border: 1px solid #bdc3c7;
        border-radius: 8px;
        background-color: #f5f7fa;
        color: #34495e;
        outline: none;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      select:hover {
        background-color: #e1e8eb;
      }

      .input-box {
        font-size: 20px;
        padding: 12px;
        margin-top: 20px;
        width: 100%;
        max-width: 500px;
        border: 2px solid #bdc3c7;
        border-radius: 8px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        outline: none;
        margin-bottom: 20px;
        transition: border-color 0.3s ease;
      }

      .input-box:focus {
        border-color: #3498db;
      }

      .map {
        display: grid;
        grid-gap: 10px;
        margin-top: 20px;
        margin-bottom: 40px;
        padding: 10px;
        width: 95%;
      }

      .territory {
        background-color: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-size: 18px;
        color: #2c3e50;
        transition: background-color 0.3s ease, transform 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        cursor: default;
      }

      .conquered {
        background-color: #2ecc71;
        color: white;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        transform: scale(1.05);
      }

      .best-time,
      .timer-display {
        font-size: 18px;
        font-weight: bold;
        position: absolute;
        color: #2c3e50;
      }

      .timer-display {
        top: 10px;
        left: 20px;
      }

      .best-time {
        top: 10px;
        right: 20px;
      }

      button {
        background-color: #3498db;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
      }

      button:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
      }

      button:disabled {
        background-color: #95a5a6;
        cursor: not-allowed;
      }

      .loading {
        margin-top: 20px;
        font-size: 18px;
        color: #3498db;
      }

      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        display: inline-block;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        display: none;
      }

      .modal.active {
        display: block;
      }

      .modal h2 {
        margin-bottom: 15px;
      }

      .modal button {
        background-color: #27ae60;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>Type & Conquer</h1>
      <div class="timer-display">Time: <span id="timer">60</span>s</div>
      <div class="best-time">Best Time: <span id="bestTime">--</span>s</div>

      <div>
        <label for="difficulty">Select Difficulty:</label>
        <select id="difficulty">
          <option value="3">Easy (3x3)</option>
          <option value="4">Medium (4x4)</option>
          <option value="5">Hard (5x5)</option>
        </select>
      </div>

      <input
        type="text"
        id="wordInput"
        class="input-box"
        placeholder="Type here..."
        disabled
      />

      <div class="grid-layout">
        <div class="map" id="map"></div>
      </div>

      <div class="loading" id="loading">
        <span class="loader"></span> Loading words...
      </div>

      <button id="startButton">Start Game</button>
    </div>

    <div id="modal" class="modal">
      <h2 id="modalMessage"></h2>
      <button id="modalButton">Close</button>
    </div>

    <script>
      // Game variables
      let wordsOnGrid = [];
      let timeLeft = 60;
      let timerInterval = null;
      let gridSize = 3; // Default to easy level (3x3)
      let totalWords = 0;

      // DOM elements
      const wordInput = document.getElementById('wordInput');
      const timerDisplay = document.getElementById('timer');
      const bestTimeDisplay = document.getElementById('bestTime');
      const map = document.getElementById('map');
      const startButton = document.getElementById('startButton');
      const difficultySelect = document.getElementById('difficulty');
      const loadingIndicator = document.getElementById('loading');
      const modal = document.getElementById('modal');
      const modalMessage = document.getElementById('modalMessage');
      const modalButton = document.getElementById('modalButton');

      // Load best time from localStorage
      function loadBestTime(level) {
        return localStorage.getItem(`bestTime-${level}`) || '--';
      }

      // Save best time to localStorage
      function saveBestTime(level, time) {
        const bestTime = parseFloat(localStorage.getItem(`bestTime-${level}`));
        if (isNaN(bestTime) || time < bestTime) {
          localStorage.setItem(`bestTime-${level}`, time);
        }
      }

      // Update best time display
      function updateBestTimeDisplay() {
        const level = difficultySelect.value;
        const bestTime = loadBestTime(level);
        bestTimeDisplay.textContent = bestTime;
      }

      // API to get random words
      const fetchRandomWords = async (count) => {
        loadingIndicator.style.display = 'block';
        const response = await fetch(
          `https://random-word-api.herokuapp.com/word?number=${count}`
        );
        const words = await response.json();
        loadingIndicator.style.display = 'none';
        return words;
      };

      // Initialize the game
      async function initGame() {
        timeLeft = 60;
        wordInput.value = '';
        wordInput.disabled = true;

        // Get the grid size based on difficulty level
        gridSize = parseInt(difficultySelect.value);
        totalWords = gridSize * gridSize;

        // Clear the map and generate new words
        map.innerHTML = '';
        map.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

        wordsOnGrid = [];
        const words = await fetchRandomWords(totalWords);

        for (let i = 0; i < totalWords; i++) {
          const word = words[i];
          wordsOnGrid.push(word);

          const territory = document.createElement('div');
          territory.classList.add('territory');
          territory.id = `territory-${i}`;
          territory.textContent = word;
          map.appendChild(territory);
        }

        // Load best time for the selected level
        updateBestTimeDisplay();
        startButton.disabled = false;
        clearInterval(timerInterval);
        timerDisplay.textContent = timeLeft;
      }

      initGame();

      // Start the game
      function startGame() {
        wordInput.disabled = false;
        wordInput.focus();
        startButton.disabled = true;
        startTimer();
      }

      // Timer function
      function startTimer() {
        timerInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            endGame(false); // Timer ran out
          }
        }, 1000);
      }

      // Handle typing input
      wordInput.addEventListener('input', (e) => {
        const typedWord = e.target.value.toLowerCase();

        // Check if the typed word matches any word in the grid
        for (let i = 0; i < wordsOnGrid.length; i++) {
          if (typedWord === wordsOnGrid[i]) {
            const territory = document.getElementById(`territory-${i}`);
            territory.classList.add('conquered');
            wordsOnGrid[i] = ''; // Remove the word from the list
            e.target.value = ''; // Clear the input field

            if (wordsOnGrid.every((word) => word === '')) {
              clearInterval(timerInterval);
              endGame(true); // All words conquered
            }
            break;
          }
        }
      });

      // End the game
      function endGame(allConquered) {
        wordInput.disabled = true;
        clearInterval(timerInterval);
        modal.classList.add('active');
        if (allConquered) {
          const remainingTime = 60 - timeLeft;
          const level = difficultySelect.value;
          saveBestTime(level, remainingTime);
          updateBestTimeDisplay();
          modalMessage.textContent = `Congratulations! You've conquered all words in ${remainingTime}s`;
        } else {
          modalMessage.textContent = 'Game Over! Time is up.';
        }
        initGame();
      }

      // Start button click event
      startButton.addEventListener('click', startGame);

      // Close modal button event
      modalButton.addEventListener('click', () => {
        modal.classList.remove('active');
      });

      // Automatically change the grid layout and words when difficulty changes
      difficultySelect.addEventListener('change', initGame);

      // Load the best time on page load
      updateBestTimeDisplay();
    </script>
  </body>
</html>
