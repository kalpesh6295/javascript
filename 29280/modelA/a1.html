<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing Speed Game</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #gameContainer {
        max-width: 600px;
        margin: 50px auto;
      }
      .grid {
        display: grid;
        gap: 5px;
        margin-top: 20px;
      }
      .grid-item {
        border: 1px solid #ccc;
        padding: 20px;
        text-align: center;
        font-size: 1.5em;
      }
      #timer,
      #bestTimes {
        position: absolute;
        top: 10px;
      }
      #timer {
        left: 10px;
      }
      #bestTimes {
        right: 10px;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <select id="difficulty" class="form-select">
        <option value="3">Easy (3x3)</option>
        <option value="4">Medium (4x4)</option>
        <option value="5" selected>Hard (5x5)</option>
      </select>
      <div id="timer">Time: 60</div>
      <div id="bestTimes">Best: --:--</div>
      <div id="loader" class="loader" style="display: none"></div>
      <div id="wordGrid" class="grid"></div>
      <input
        type="text"
        id="typeInput"
        placeholder="Start typing here..."
        disabled
      />
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const wordGrid = document.getElementById('wordGrid');
        const loader = document.getElementById('loader');
        const typeInput = document.getElementById('typeInput');
        const timerDisplay = document.getElementById('timer');
        const bestTimesDisplay = document.getElementById('bestTimes');
        const difficultySelect = document.getElementById('difficulty');
        let words = [];
        let currentWordIndex = 0;
        let timer;
        let timeLeft = 60;
        let gridSize = 5;
        let bestTimes =
          JSON.parse(localStorage.getItem('typingGameBestTimes')) || {};

        function fetchWords() {
          loader.style.display = 'block';
          fetch(
            `https://random-word-api.herokuapp.com/word?number=${
              gridSize * gridSize
            }`
          )
            .then((response) => response.json())
            .then((data) => {
              words = data;
              setupGame();
              loader.style.display = 'none';
            })
            .catch(() => {
              loader.style.display = 'none';
              alert('Failed to load words. Try again.');
            });
        }

        function setupGame() {
          wordGrid.innerHTML = '';
          words.forEach((word) => {
            const div = document.createElement('div');
            div.className = 'grid-item';
            div.textContent = word;
            wordGrid.appendChild(div);
          });
          wordGrid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
          startGame();
        }

        function startGame() {
          typeInput.disabled = false;
          typeInput.focus();
          currentWordIndex = 0;
          timeLeft = 60;
          timer = setInterval(updateTimer, 1000);
          updateBestTimeDisplay();
        }

        function updateTimer() {
          timeLeft--;
          timerDisplay.textContent = `Time: ${timeLeft}`;
          if (timeLeft <= 0) {
            clearInterval(timer);
            endGame();
          }
        }

        function endGame() {
          typeInput.disabled = true;
          if (!bestTimes[gridSize] || timeLeft > bestTimes[gridSize]) {
            bestTimes[gridSize] = 60 - timeLeft;
            localStorage.setItem(
              'typingGameBestTimes',
              JSON.stringify(bestTimes)
            );
          }
          updateBestTimeDisplay();
          alert(
            `Game Over! You ${
              currentWordIndex === words.length
                ? 'conquered all words!'
                : 'ran out of time.'
            }`
          );
        }

        function updateBestTimeDisplay() {
          const bestTime = bestTimes[gridSize] || '--:--';
          bestTimesDisplay.textContent = `Best: ${bestTime}s`;
        }

        typeInput.addEventListener('input', function () {
          if (this.value === words[currentWordIndex]) {
            wordGrid.children[currentWordIndex].style.backgroundColor =
              'lightgreen';
            currentWordIndex++;
            this.value = '';
            if (currentWordIndex === words.length) {
              clearInterval(timer);
              endGame();
            }
          }
        });

        difficultySelect.addEventListener('change', function () {
          gridSize = parseInt(this.value);
          fetchWords();
        });

        fetchWords(); // Initial fetch
      });
    </script>
  </body>
</html>
