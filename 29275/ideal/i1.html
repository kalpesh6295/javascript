<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing Speed Game</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .container {
        background: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        text-align: center;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 20px;
        color: #333;
      }

      .stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .stats div {
        font-size: 1.2rem;
        color: #555;
      }

      select,
      button,
      input {
        padding: 12px;
        font-size: 1rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        outline: none;
        margin-bottom: 15px;
        width: 100%;
      }

      button {
        background-color: #28a745;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #218838;
      }

      select {
        background-color: #f9f9f9;
      }

      input {
        background-color: #f9f9f9;
      }

      .word-display {
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: #444;
      }

      .game-over {
        font-size: 1.5rem;
        color: red;
      }

      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Typing Speed Game</h1>
      <div class="stats">
        <div>Time: <span id="time">60</span></div>
        <div>Score: <span id="score">0</span></div>
        <div>Best Score: <span id="best-score">0</span></div>
      </div>
      <select id="difficulty">
        <option value="easy">Easy (3-4 letters)</option>
        <option value="medium">Medium (5-6 letters)</option>
        <option value="hard">Hard (6-7 letters)</option>
      </select>
      <div class="word-display" id="word-display">Press Start</div>
      <input type="text" id="word-input" placeholder="Type here..." disabled />
      <button id="start-btn">Start Game</button>
      <div class="loader" id="loader" style="display: none"></div>
    </div>

    <script>
      const wordDisplay = document.getElementById('word-display');
      const wordInput = document.getElementById('word-input');
      const scoreDisplay = document.getElementById('score');
      const timeDisplay = document.getElementById('time');
      const bestScoreDisplay = document.getElementById('best-score');
      const startButton = document.getElementById('start-btn');
      const difficultySelect = document.getElementById('difficulty');
      const loader = document.getElementById('loader');

      let words = [];
      let filteredWords = [];
      let time = 60;
      let score = 0;
      let bestScore = 0;
      let currentWord = '';
      let countdown;
      let isPlaying = false;
      let difficulty = 'easy';

      // Initially updating best score
      updateBestScore();

      // Fetch 10,000 random words from an external API (this example uses a placeholder API)
      loader.style.display = 'block';
      fetch('https://random-word-api.herokuapp.com/word?number=10000')
        .then((response) => response.json())
        .then((data) => {
          words = data;
          loader.style.display = 'none'; // Hide loader after fetching
        })
        .catch((err) => console.error('Error fetching words:', err));

      // Event listener to update best score when difficulty changes
      difficultySelect.addEventListener('change', updateBestScoreOnChange);

      // Start Game
      startButton.addEventListener('click', startGame);

      // Function to start the game
      function startGame() {
        if (words.length === 0) {
          alert('Words are still loading. Please wait a moment.');
          return;
        }

        isPlaying = true;
        score = 0;
        time = 60;
        wordInput.value = '';
        wordInput.disabled = false;
        wordInput.focus();
        difficulty = difficultySelect.value;
        updateWord();
        updateScore();
        updateBestScore();
        startButton.disabled = true;
        countdown = setInterval(updateTime, 1000);
      }

      // Function to update the word based on difficulty
      function updateWord() {
        filteredWords = filterWordsByDifficulty(difficulty);
        currentWord =
          filteredWords[Math.floor(Math.random() * filteredWords.length)];
        wordDisplay.textContent = currentWord;
      }

      // Function to filter words based on selected difficulty
      function filterWordsByDifficulty(difficulty) {
        let minLength, maxLength;
        switch (difficulty) {
          case 'easy':
            minLength = 3;
            maxLength = 4;
            break;
          case 'medium':
            minLength = 5;
            maxLength = 6;
            break;
          case 'hard':
            minLength = 6;
            maxLength = 7;
            break;
        }
        return words.filter(
          (word) => word.length >= minLength && word.length <= maxLength
        );
      }

      // Function to update time
      function updateTime() {
        time--;
        timeDisplay.textContent = time;

        if (time === 0) {
          clearInterval(countdown);
          endGame();
        }
      }

      // Function to update score
      function updateScore() {
        scoreDisplay.textContent = score;
      }

      // Function to update the best score using localStorage
      function updateBestScore() {
        let storedBestScore = localStorage.getItem(`${difficulty}-bestScore`);
        if (storedBestScore) {
          bestScore = parseInt(storedBestScore);
        } else {
          bestScore = 0;
        }
        bestScoreDisplay.textContent = bestScore;
      }

      // Function to update the best score when difficulty is changed
      function updateBestScoreOnChange() {
        difficulty = difficultySelect.value;
        updateBestScore(); // Fetch and display the best score for the selected difficulty
      }

      // Function to end the game
      function endGame() {
        isPlaying = false;
        wordInput.disabled = true;
        startButton.disabled = false;
        wordDisplay.textContent = 'Game Over!';
        if (score > bestScore) {
          localStorage.setItem(`${difficulty}-bestScore`, score);
        }
        updateBestScore(); // Update the best score after the game ends
      }

      // Typing event
      wordInput.addEventListener('input', () => {
        if (wordInput.value === currentWord && isPlaying) {
          score++;
          updateWord();
          wordInput.value = '';
          updateScore();
        }
      });
    </script>
  </body>
</html>
